
<!DOCTYPE html>
<html>
<head>
  <script src="../dist/underscore.js"></script>
  <script src="../dist/shifty.js"></script>
  <script src="../dist/rekapi.min.js"></script>
  <!--<script src="../src/rekapi.core.js"></script>-->
  <!--<script src="../src/rekapi.actor.js"></script>-->
  <!--<script src="../src/rekapi.dom.js"></script>-->
  <!--<script src="../src/rekapi.canvas.js"></script>-->
  <!--<script src="../src/rekapi.interpolate.js"></script>-->
</head>
<body>
  <canvas></canvas>
  <script>
  (function (global) {

    function makeBubble () {
      return new Kapi.Actor({
        'draw': function (canvas_context, state) {
          canvas_context.beginPath();
          canvas_context.arc(
            state.x || 0,
            state.y || 0,
            Math.abs(state.radius || 50),
            0,
            Math.PI*2, 
            true);
          canvas_context.fillStyle = state.color;
          canvas_context.fill();
          canvas_context.closePath();
        }
      });
    }

    function getBubbleX () {
      return Math.random() * kapi.canvas_width();
    }

    function getBubbleY () {
      return Math.random() * kapi.canvas_height();
    }

    function getSize () {
      return 5 + (Math.random() * 20);
    }
    
    function getColor () {
      return'rgb('
        + parseInt(Math.random() * 255, 10) + ','
        + parseInt(Math.random() * 255, 10) + ','
        + parseInt(Math.random() * 255, 10) + ')';
    }

    function getRandomEasing () {
      var keys = ['bouncePast', 'easeInOutBack', 'swingFromTo']

      return keys[parseInt(Math.random() * keys.length, 10)];
    }

    function generateRandomFrame (actor) {
      return actor.keyframe(time += 2250, {
        'x': getBubbleX()
        ,'y': getBubbleY()
        ,'radius': getSize()
        ,'color': getColor()
      }, {
        'x': getRandomEasing()
        ,'y': getRandomEasing()
        ,'radius': getRandomEasing()
        ,'color': getRandomEasing()
      }).liveCopy(time += 750);
    }

    var canvas = document.getElementsByTagName('canvas')[0]
        ,kapi = new Kapi(canvas, {
          'fps': 30
          ,'height': 500
          ,'width': 500
        })
        ,bubbles = []
        ,i ,j
        ,time;

    kapi.canvas_style('background', '#eee');

    for (i = 0; i < 30; i++) {
      time = 0;
      bubbles[i] = makeBubble();
      kapi.addActor(bubbles[i]);

      bubbles[i].keyframe(time, {
        'x': kapi.canvas_width() / 2
        ,'y': kapi.canvas_height() + 50
        ,'radius': 0
        ,'color': getColor()
      }, {
        'x': getRandomEasing()
        ,'y': getRandomEasing()
        ,'radius': getRandomEasing()
        ,'color': getRandomEasing()
      });

    for (j = 0; j < 5; j++) {
      generateRandomFrame(bubbles[i]);
    }

    bubbles[i]
      .liveCopy(time += 1500, 0)
      .liveCopy(time += 750);
    }

    kapi.play();
  
  } (this));
  </script>
</body>
</html>
