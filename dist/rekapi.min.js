/*! Rekapi - v0.15.12 - 2013-08-03 - http://rekapi.com */
(function(){function t(t,e,n,i){n.each(t._events[e],function(e){e(t,i)})}function e(t,e){var n=[];e.each(t._actors,function(t){n.push(t.getEnd())}),t._animationLength=Math.max.apply(Math,n)}function n(){}var i=function(n,i,r){"use strict";function o(t,e){var n=Math.floor(e/t._animationLength);return n}function a(t){return g()-t._loopTimestamp}function s(t,e){return e>=t._timesToIterate&&-1!==t._timesToIterate}function c(e,n){s(e,n)&&(e.stop(),t(e,"animationComplete",i))}function u(t,e,n){var i;return i=s(t,n)?t._animationLength:e%t._animationLength}function p(t,e){var n=o(t,e),i=u(t,e,n);t.update(i),c(t,n)}function h(t){p(t,a(t))}function f(t){var e=function(){f(t),h(t)};t._loopId=t._scheduleUpdate.call?t._scheduleUpdate.call(_,e,1e3/t.config.fps):setTimeout(e,1e3/t.config.fps)}function l(t){var e;return e=60!==t?_.setTimeout:_.requestAnimationFrame||_.webkitRequestAnimationFrame||_.oRequestAnimationFrame||_.msRequestAnimationFrame||_.mozCancelRequestAnimationFrame&&_.mozRequestAnimationFrame||_.setTimeout}function d(t){var e;return e=60!==t?_.clearTimeout:_.cancelAnimationFrame||_.webkitCancelAnimationFrame||_.oCancelAnimationFrame||_.msCancelAnimationFrame||_.mozCancelRequestAnimationFrame||_.clearTimeout}function m(t){t._cancelUpdate.call?t._cancelUpdate.call(_,t._loopId):clearTimeout(t._loopId)}function y(t){return this.config=t||{},this.context=this.config.context||{},this._actors={},this._playState=T.STOPPED,this._events={animationComplete:[],playStateChange:[],play:[],pause:[],stop:[],beforeUpdate:[],afterUpdate:[],addActor:[],removeActor:[]},this._timesToIterate=-1,this._animationLength=0,this._loopId=null,this._loopTimestamp=null,this._pausedAtTime=null,this._lastUpdatedMillisecond=0,i.extend(this.config,t),i.defaults(this.config,k),this._scheduleUpdate=l(this.config.fps),this._cancelUpdate=d(this.config.fps),i.each(this._contextInitHook,function(t){t.call(this)},this),this}var v=Function,_=new v("return this")(),g=r.now,k={fps:60},T={STOPPED:"stopped",PAUSED:"paused",PLAYING:"playing"};y.prototype._contextInitHook={},y.prototype.addActor=function(n){return i.contains(this._actors,n)||(n.context()||n.context(this.context),n.kapi=this,n.fps=this.framerate(),this._actors[n.id]=n,e(this,i),n.setup(),t(this,"addActor",i,n)),this},y.prototype.getActor=function(t){return this._actors[t]},y.prototype.getActorIds=function(){return i.pluck(this._actors,"id")},y.prototype.getAllActors=function(){return i.clone(this._actors)},y.prototype.removeActor=function(n){return delete this._actors[n.id],delete n.kapi,n.teardown(),e(this,i),t(this,"removeActor",i,n),this},y.prototype.play=function(e){return m(this),this._playState===T.PAUSED?this._loopTimestamp+=g()-this._pausedAtTime:this._loopTimestamp=g(),this._timesToIterate=e||-1,this._playState=T.PLAYING,f(this),t(this,"playStateChange",i),t(this,"play",i),this},y.prototype.playFrom=function(t,e){return this.play(e),this._loopTimestamp=g()-t,this},y.prototype.playFromCurrent=function(t){return this.playFrom(this._lastUpdatedMillisecond,t)},y.prototype.pause=function(){return this._playState===T.PAUSED?this:(this._playState=T.PAUSED,m(this),this._pausedAtTime=g(),t(this,"playStateChange",i),t(this,"pause",i),this)},y.prototype.stop=function(){return this._playState=T.STOPPED,m(this),i.each(this._actors,function(t){t.stop()}),t(this,"playStateChange",i),t(this,"stop",i),this},y.prototype.isPlaying=function(){return this._playState===T.PLAYING},y.prototype.animationLength=function(){return this._animationLength},y.prototype.lastPositionUpdated=function(){return this._lastUpdatedMillisecond/this._animationLength},y.prototype.actorCount=function(){return i.size(this._actors)},y.prototype.framerate=function(t){return t&&(this.config.fps=t,this._scheduleUpdate=l(this.config.fps),this._cancelUpdate=d(this.config.fps)),this.config.fps},y.prototype.update=function(e){return void 0===e&&(e=this._lastUpdatedMillisecond),t(this,"beforeUpdate",i),i.each(this._actors,function(t){t.updateState(e),"function"==typeof t.update&&t.update(t.context(),t.get())}),this._lastUpdatedMillisecond=e,t(this,"afterUpdate",i),this},y.prototype.on=function(t,e){return this._events[t]?(this._events[t].push(e),this):void 0},y.prototype.off=function(t,e){return this._events[t]?(this._events[t]=e?i.without(this._events[t],e):[],this):void 0},y.prototype.exportTimeline=function(){var t={duration:this._animationLength,actors:{}};return i.each(this._actors,function(e){t.actors[e.id]=e.exportTimeline()},this),t},y.util={},n.Kapi=y},r=function(i,r,o){"use strict";function a(t){return t.sort(function(t,e){return t-e})}function s(t,e){var n,i=t._timelinePropertyCacheIndex,r=i.length;for(n=1;r>n;n++)if(i[n]>=e)return n-1;return-1}function c(t){r.each(t._propertyTracks,function(e,n){t._propertyTracks[n]=r.sortBy(t._propertyTracks[n],function(t){return t.millisecond})})}function u(t){r.each(t._timelinePropertyCaches,function(e,n){var i=p(t,+n);r.defaults(e,i)})}function p(t,e){var n={};return r.each(t._propertyTracks,function(t,i){var o=null;if(r.find(t,function(t){return t.millisecond>e?n[i]=o:t.millisecond===e&&(n[i]=t),o=t,!!n[i]}),!n[i]){var a=r.last(t);a&&e>=a.millisecond&&(n[i]=a)}}),n}function h(t){r.each(t._propertyTracks,function(t){r.each(t,function(e,n){e.linkToNext(t[n+1])})})}function f(t,e,n){return r.find(t._propertyTracks[e],function(t){return t.millisecond===n})}function l(e){e._timelinePropertyCaches={},r.each(e._keyframeProperties,function(t){e._timelinePropertyCaches[t.millisecond]||(e._timelinePropertyCaches[t.millisecond]={}),e._timelinePropertyCaches[t.millisecond][t.name]=t},e),e._timelinePropertyCacheIndex=r.keys(e._timelinePropertyCaches),r.each(e._timelinePropertyCacheIndex,function(t,n){e._timelinePropertyCacheIndex[n]=+t},e),a(e._timelinePropertyCacheIndex),u(e),h(e),e.kapi&&t(e.kapi,"timelineModified",r)}function d(t){c(t),l(t),e(t.kapi,r)}var m="linear",y=i.Kapi;y.Actor=function(t){return t=t||{},o.call(this),r.extend(this,{_propertyTracks:{},_timelinePropertyCaches:{},_timelinePropertyCacheIndex:[],_keyframeProperties:{},id:r.uniqueId(),setup:t.setup||n,update:t.update||n,teardown:t.teardown||n,data:{}}),t.context&&this.context(t.context),this};var v=y.Actor,_=function(){};_.prototype=o.prototype,v.prototype=new _,v.prototype.context=function(t){return t&&(this._context=t),this._context},v.prototype.keyframe=function(t,n,i){var o;return i=i||m,"string"==typeof i&&(o=i,i={},r.each(n,function(t,e){i[e]=o})),r.each(n,function(t,e){i[e]=i[e]||m}),r.each(n,function(e,n){var r=new y.KeyframeProperty(this,t,n,e,i[n]);this._keyframeProperties[r.id]=r,this._propertyTracks[n]||(this._propertyTracks[n]=[]),this._propertyTracks[n].push(r),c(this)},this),this.kapi&&e(this.kapi,r),l(this),this},v.prototype.getKeyframeProperty=function(t,e){return this._propertyTracks[t]&&this._propertyTracks[t][e]?this._propertyTracks[t][e]:void 0},v.prototype.modifyKeyframeProperty=function(t,e,n){return this._propertyTracks[t]&&this._propertyTracks[t][e]&&this._propertyTracks[t][e].modifyWith(n),d(this),this},v.prototype.getTrackNames=function(){return r.keys(this._propertyTracks)},v.prototype.getTrackLength=function(t){return this._propertyTracks[t]?this._propertyTracks[t].length:void 0},v.prototype.copyProperties=function(t,e){var n={},i={};return r.each(this._propertyTracks,function(t,r){var o=f(this,r,e);o&&(n[r]=o.value,i[r]=o.easing)},this),this.keyframe(t,n,i),this},v.prototype.wait=function(t){var e=this.getEnd();if(e>=t)return this;var n=this.getEnd(),i=p(this,this.getEnd()),o={},a={};return r.each(i,function(t,e){o[e]=t.value,a[e]=t.easing}),this.removeKeyframe(n),this.keyframe(n,o,a),this.keyframe(t,o,a),this},v.prototype.getStart=function(t){var e=[];return t?e.push(this._propertyTracks[t][0].millisecond):r.each(this._propertyTracks,function(t){t.length&&e.push(t[0].millisecond)}),0===e.length&&(e=[0]),Math.min.apply(Math,e)},v.prototype.getEnd=function(t){var e=0,n=this._propertyTracks;return t&&(n={},n[t]=this._propertyTracks[t]),r.each(n,function(t){if(t.length){var n=r.last(t).millisecond;n>e&&(e=n)}},this),e},v.prototype.getLength=function(t){return this.getEnd(t)-this.getStart(t)},v.prototype.hasKeyframeAt=function(t,e){var n=this._propertyTracks;if(e){if(!r.has(n,e))return!1;n=r.pick(n,e)}return void 0!==r.find(n,function(e,n){var i=f(this,n,t);return void 0!==i},this)},v.prototype.moveKeyframe=function(t,e){return!this.hasKeyframeAt(t)||this.hasKeyframeAt(e)?!1:(r.each(this._propertyTracks,function(n,i){var r=f(this,i,t);r&&r.modifyWith({millisecond:e})},this),d(this),!0)},v.prototype.modifyKeyframe=function(t,e,n){return n=n||{},r.each(this._propertyTracks,function(i,r){var o=f(this,r,t);o&&o.modifyWith({value:e[r],easing:n[r]})},this),this},v.prototype.removeKeyframe=function(t){return r.each(this._propertyTracks,function(e){var n=-1,i=!1;if(r.find(e,function(e){return n++,i=t===e.millisecond}),i){var o=e.splice(n,1)[0];o&&delete this._keyframeProperties[o.id]}},this),this.kapi&&e(this.kapi,r),l(this),this},v.prototype.removeAllKeyframeProperties=function(){return r.each(this._propertyTracks,function(t){t.length=0},this),this._keyframeProperties={},this.removeKeyframe(0)},v.prototype.updateState=function(t){var e=this.getStart(),n=this.getEnd();if(t=Math.min(n,t),t>=e){var i=s(this,t),o=this._timelinePropertyCaches[this._timelinePropertyCacheIndex[i]],a={};r.each(o,function(e,n){e&&(a[n]=e.getValueAt(t))}),this.set(a)}return this},v.prototype.exportTimeline=function(){var t={start:this.getStart(),end:this.getEnd(),trackNames:this.getTrackNames(),propertyTracks:{}};return r.each(this._propertyTracks,function(e,n){var i=t.propertyTracks[n]=[];r.each(e,function(t){i.push(t.exportPropertyData())})}),t}},o=function(t,e,n){"use strict";var i="linear",r=t.Kapi;r.KeyframeProperty=function(t,n,r,o,a){return this.id=e.uniqueId("keyframeProperty_"),this.ownerActor=t,this.millisecond=n,this.name=r,this.value=o,this.easing=a||i,this.nextProperty=null,this};var o=r.KeyframeProperty;o.prototype.modifyWith=function(t){var n={};e.each(["millisecond","easing","value"],function(e){n[e]=t[e]===void 0?this[e]:t[e]},this),e.extend(this,n)},o.prototype.linkToNext=function(t){this.nextProperty=t||null},o.prototype.getValueAt=function(t){var e,i={},r={};if(this.nextProperty){i[this.name]=this.value,r[this.name]=this.nextProperty.value;var o=this.nextProperty.millisecond-this.millisecond,a=(t-this.millisecond)/o;e=n.interpolate(i,r,a,this.nextProperty.easing)[this.name]}else e=this.value;return e},o.prototype.exportPropertyData=function(){return{id:this.id,millisecond:this.millisecond,name:this.name,value:this.value,easing:this.easing}}},a=function(e,n){"use strict";function i(t,e,n){return n!==void 0&&(t[e]=n,t.style[e]=n+"px"),t[e]}function r(t){t.config.clearOnUpdate&&t.canvas.clear()}function o(e){t(e,"beforeDraw",n);var i,r=e.canvas._drawOrder.length;if(e.canvas._drawOrderSorter){var o=n.sortBy(e.canvas._canvasActors,e.canvas._drawOrderSorter);i=n.pluck(o,"id")}else i=e.canvas._drawOrder;var a,s,c;for(c=0;r>c;c++)a=e.canvas._canvasActors[i[c]],s=a.context(),a.draw(s,a.get());return t(e,"afterDraw",n),e}function a(t,e){e instanceof c.CanvasActor&&(t.canvas._drawOrder.push(e.id),t.canvas._canvasActors[e.id]=e)}function s(t,e){e instanceof c.CanvasActor&&(t.canvas._drawOrder=n.without(t.canvas._drawOrder,e.id),delete t.canvas._canvasActors[e.id])}var c=e.Kapi;c.prototype._contextInitHook.canvas=function(){this.context.getContext&&(this.canvas=new u(this),this.config.clearOnUpdate=!0,n.extend(this._events,{beforeDraw:[],afterDraw:[]}),n.each(["Height","Width"],function(t){var e=t.toLowerCase();this.config[e]&&(this.canvas[e](this.config[e]),delete this.config[t])},this),this.on("afterUpdate",o),this.on("addActor",a),this.on("removeActor",s),this.on("beforeDraw",r))},c.CanvasRenderer=function(t){return this.kapi=t,this._drawOrder=[],this._drawOrderSorter=null,this._canvasActors={},this};var u=c.CanvasRenderer;u.prototype.height=function(t){return i(this.kapi.context,"height",t)},u.prototype.width=function(t){return i(this.kapi.context,"width",t)},u.prototype.clear=function(){return this.kapi.context.getContext&&this.context().clearRect(0,0,this.width(),this.height()),this.kapi},u.prototype.context=function(){return this.kapi.context.getContext("2d")},u.prototype.moveActorToLayer=function(t,e){return this._drawOrder.length>e?(this._drawOrder=n.without(this._drawOrder,t.id),this._drawOrder.splice(e,0,t.id),t):void 0},u.prototype.setOrderFunction=function(t){return this._drawOrderSorter=t,this.kapi},u.prototype.unsetOrderFunction=function(){return this._drawOrderSorter=null,this.kapi}},s=function(t){"use strict";function e(){}var i=t.Kapi;i.CanvasActor=function(t){return i.Actor.call(this,t),t=t||{},this.draw=t.draw||n,this};var r=i.CanvasActor;e.prototype=i.Actor.prototype,r.prototype=new e,r.prototype.context=function(t){return t&&(this._context=t),this._context&&this._context.getContext("2d")},r.prototype.moveToLayer=function(t){return this.kapi.canvas.moveActorToLayer(this,t)}},c=function(t,e){"use strict";function n(t,e,n){t.style[e]=n}function i(t){return e.contains(u,t)}function r(t,n){var i=[];return e.each(t,function(t){n[t]&&i.push(t+"("+n[t]+")")}),i.join(" ")}function o(t,i){e.each(c,function(e){n(t,e,i)})}function a(){}var s=t.Kapi,c=["transform","webkitTransform","MozTransform","oTransform","msTransform"],u=["translateX","translateY","scale","scaleX","scaleY","rotate","skewX","skewY"];s.DOMActor=function(t,e){s.Actor.call(this,e),this._context=t;var n=this.getCSSName();return this._context.className.match(n)||(this._context.className+=" "+n),this._transformOrder=u.slice(0),delete this.update,delete this.teardown,this};var p=s.DOMActor;a.prototype=s.Actor.prototype,p.prototype=new a,p.prototype.update=function(t,a){var s=e.keys(a),c=e.filter(s,i),u=e.reject(s,i),p=e.pick(a,u);if(c.length){var h=e.pick(a,c),f=r(this._transformOrder,h);o(t,f)}else a.transform&&o(t,a.transform);e.each(p,function(e,i){n(t,i,e)},this)},p.prototype.teardown=function(){var t=this._context.className.match(/\S+/g),n=e.without(t,this.getCSSName());this._context.className=n},p.prototype.getCSSName=function(){return"actor-"+this.id},p.prototype.setTransformOrder=function(t){var n=e.reject(t,i);if(n.length)throw"Unknown or unsupported transform functions: "+n.join(", ");return this._transformOrder=e.uniq(t),this}},u=function(t,e){"use strict";function n(t){return 0===t%1}function i(t,n,i,o){var a=t.getTrackNames(),s=[];e.each(a,function(e){s.push(v(t,i,e))});var c=[];return e.each(a,function(t,e){c.push(r(s[e],n+"-"+t,o))}),c=c.join("\n")}function r(t,n,i){i=i||["w3"];var r=[];return e.each(i,function(e){var i=L(I,[P[e],n,t]),a=o(i,e);r.push(a)}),r.join("\n")}function o(t,e){var n=RegExp(w,"g"),i=P[e]+"transform",r=RegExp(C,"g"),o=P[e],a=t.replace(r,o).replace(n,i);return a}function a(t,n,i,r,o){i=i||["w3"];var a,c=[];e.each(i,function(e){a=s(t,n,e,r,o),c.push(a)});var u=L(E,[n,c.join("\n")]);return u}function s(t,e,n,i,r){var o=[],a=P[n];return o.push(c(t,e,a)),o.push(u(t,a)),o.push(p(t,a)),o.push(h(a)),o.push(f(a)),o.push(l(t.kapi,a,i)),r&&o.push(d(a)),o.join("\n")}function c(t,n,i){var r=L("  %sanimation-name:",[i]),o=t.getTrackNames();return e.each(o,function(t){r+=L(" %s-%s-keyframes,",[n,t])}),r=r.slice(0,r.length-1),r+=";"}function u(t,e){return L("  %sanimation-duration: %sms;",[e,t.getEnd()-t.getStart()])}function p(t,e){return L("  %sanimation-delay: %sms;",[e,t.getStart()])}function h(t){return L("  %sanimation-fill-mode: forwards;",[t])}function f(t){return L("  %sanimation-timing-function: linear;",[t])}function l(t,e,n){var i;i=n?n:-1===t._timesToIterate?"infinite":t._timesToIterate;var r="  %sanimation-iteration-count: %s;";return L(r,[e,i])}function d(t){return L("  %stransform-origin: 0 0;",[t])}function m(t){var e=!1;if(t.nextProperty){var n,i=t.nextProperty.easing.split(" "),r=0,o=i.length,a=i[0];for(r;o>r;r++){if(n=i[r],!O[n]||a!==n){e=!1;break}e=!0,a=n}}return e}function y(t,e,i){var r=[],o=t.name;"transform"===t.name&&(o=w);var a=O[t.nextProperty.easing.split(" ")[0]],s=L("cubic-bezier(%s)",[a]),c=n(e)?e:e.toFixed(2),u=n(i)?i:i.toFixed(2);return r.push(L("  %s% {%s:%s;%sanimation-timing-function: %s;}",[c,o,t.value,C,s])),r.push(L("  %s% {%s:%s;}",[u,o,t.nextProperty.value])),r.join("\n")}function v(t,n,i){var r=[],o=t.getEnd(),a=t.getStart(),s=t.getLength(),c=_(t,i,a);c&&r.push(c);var u=!1;e.each(t._propertyTracks[i],function(e){var i,o,c,p=k(e,a,s),h=e.nextProperty;if(h){i=k(h,a,s);var f=i-p;o=Math.floor(f/100*n)||1,c=f/o}else i=100,o=1,c=1;var l;if(m(e)){if(l=y(e,p,i),u){var d=r.length,v=r[d-1],_=v.split("\n")[0];r[d-1]=_}u=!0}else l=T(t,e,o,c,a,p),u&&l.shift(),l.length&&(l=l.join("\n")),u=!1;l.length&&r.push(l)});var p=g(t,i,a,o);return p&&r.push(p),r.join("\n")}function _(t,e,n){var i=t._propertyTracks[e][0];if(i.millisecond!==n){var r=T(t,i,1,1,i.millisecond,0);return r.join("\n")}}function g(t,n,i,r){var o=e.last(t._propertyTracks[n]);if(o.millisecond!==r){var a=T(t,o,1,1,i,100);return a.join("\n")}}function k(t,e,n){return 100*((t.millisecond-e)/n)}function T(t,e,n,i,r,o){var a,s,c,u=[],p=t.getLength();for(a=0;n>a;a++)s=o+a*i,t.updateState(s/100*p+r),c=+s.toFixed(2)+"% ",u.push("  "+c+S(t,e.name));return u}function S(t,n){var i,r=["{"];if(n){i={};var o=t.get()[n];o!==void 0&&(i[n]=o)}else i=t.get();var a;return e.each(i,function(t,e){a=t;var n=e;"transform"===e&&(n=w),r.push(n+":"+a+";")}),r.push("}"),r.join("")}var x=t.Kapi,A=30,w="TRANSFORM",C="VENDOR",P=x.util.VENDOR_PREFIXES={microsoft:"-ms-",mozilla:"-moz-",opera:"-o-",w3:"",webkit:"-webkit-"},O={linear:".25,.25,.75,.75",easeInQuad:".55,.085,.68,.53",easeInCubic:".55,.055,.675,.19",easeInQuart:".895,.03,.685,.22",easeInQuint:".755,.05,.855,.06",easeInSine:".47,0,.745,.715",easeInExpo:".95,.05,.795,.035",easeInCirc:".6,.04,.98, .335",easeOutQuad:".25,.46,.45,.94",easeOutCubic:".215,.61,.355,1",easeOutQuart:".165,.84,.44,1",easeOutQuint:".23,1,.32,1",easeOutSine:".39,.575,.565,1",easeOutExpo:".19,1,.22,1",easeOutCirc:".075,.82,.165,1",easeInOutQuad:".455,.03,.515,.955",easeInOutCubic:".645,.045,.355,1",easeInOutQuart:".77,0,.175,1",easeInOutQuint:".86,0.07,1",easeInOutSine:".445,.05,.55,.95",easeInOutExpo:"1,0,0,1",easeInOutCirc:".785,.135,.15,.86"},I=["@%skeyframes %s-keyframes {","%s","}"].join("\n"),E=[".%s {","%s","}"].join("\n");x.prototype.toCSS=function(t){t=t||{};var n=[];return e.each(this.getAllActors(),function(e){e instanceof x.DOMActor&&n.push(e.toCSS(t))}),n.join("\n")},x.Actor.prototype.toCSS=function(t){t=t||{};var e=[],n=t.name||this.getCSSName(),r=t.fps||A,o=Math.ceil(this.kapi.animationLength()/1e3*r),s=a(this,n,t.vendors,t.iterations,t.isCentered),c=i(this,n,o,t.vendors);return e.push(s),e.push(c),e.join("\n")};var L=x.util.printf=function(t,n){var i=t;return e.each(n,function(t){i=i.replace("%s",t)}),i}},p=function(e,n,i){"use strict";function r(){var t=document.body.style;return"-webkit-animation"in t?"webkit":"-moz-animation"in t?"mozilla":"-ms-animation"in t?"microsoft":"-o-animation"in t?"opera":"animation"in t?"w3":""}function o(t){var e=document.createElement("style"),n="rekapi-"+u++;return e.id=n,e.innerHTML=t,document.head.appendChild(e),e}function a(t){var e=document.createElement("div");n.each(t.getAllActors(),function(t){if(t instanceof s.DOMActor){var n=t._context,i=n.parentElement;i.replaceChild(e,n),i.replaceChild(n,e)}}),e=null}var s=e.Kapi,c=250;s.prototype._contextInitHook.cssAnimate=function(){this.css=new p(this)};var u=0;s.CSSRenderer=function(t){if(!s.DOMActor&&!s.prototype.toCSS)throw"CSSRenderer requires the DOMActor and toCSS modules.";return this.kapi=t,this._playTimestamp=null,this._cachedCSS=null,this._styleElement=null,this._stopSetTimeoutHandle=null,t.on("timelineModified",n.bind(function(){this._cachedCSS=null},this)),this};var p=s.CSSRenderer;p.prototype.canAnimateWithCSS=function(){return!!r()},p.prototype.prerender=function(t,e){return this._cachedCSS=this.kapi.toCSS({vendors:[r()],fps:e,iterations:t})},p.prototype.play=function(e){this.isPlaying()&&this.stop();var r=this._cachedCSS||this.prerender.apply(this,arguments);if(this._styleElement=o(r),this._playTimestamp=i.now(),navigator.userAgent.match(/Presto/)&&a(this.kapi),e){var s=e*this.kapi.animationLength();this._stopSetTimeoutHandle=setTimeout(n.bind(this.stop,this,!0),s+c)}t(this.kapi,"play",n)},p.prototype.stop=function(e){if(this.isPlaying()){clearTimeout(this._stopSetTimeoutHandle),this._styleElement.innerHTML="",document.head.removeChild(this._styleElement),this._styleElement=null;var r;r=e?this.kapi.animationLength():(i.now()-this._playTimestamp)%this.kapi.animationLength(),this.kapi.update(r),t(this.kapi,"stop",n)}},p.prototype.isPlaying=function(){return!!this._styleElement}},h=function(t,e){"use strict";var n=e?{}:t,h=e&&e.underscore?e.underscore:n._,f=e&&e.Tweenable?e.Tweenable:n.Tweenable;return i(n,h,f),r(n,h,f),o(n,h,f),"function"==typeof c&&c(n,h,f),"function"==typeof u&&u(n,h,f),"function"==typeof a&&a(n,h,f),"function"==typeof s&&s(n,h,f),"function"==typeof p&&p(n,h,f),n.Kapi};if("function"==typeof define&&define.amd){var f="undefined"!=typeof _;define(["shifty","underscore"],function(t,e){var n=null!=e,i={Tweenable:t,underscore:n?e:_},r=h({},i);return!f&&n&&(this._=void 0),r})}else h(this)})(this);