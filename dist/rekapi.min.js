/*! Rekapi - v0.13.9 - 2013-03-05 - http://rekapi.com */
(function(t){function e(t,e,n,r){n.each(t._events[e],function(e){e(t,r)})}function n(t){var e=[];_.each(t._actors,function(t){e.push(t.getEnd())}),t._animationLength=Math.max.apply(Math,e)}function r(){}var i=function(t,r,i){"use strict";function o(t,e){var n=Math.floor(e/t._animationLength);return n}function a(t){return _()-t._loopTimestamp}function s(t,e){return e>=t._timesToIterate&&-1!==t._timesToIterate}function c(t,n){s(t,n)&&(t.stop(),e(t,"animationComplete",r))}function u(t,e,n){var r;return r=s(t,n)?t._animationLength:e%t._animationLength}function p(t,e){var n=o(t,e),r=u(t,e,n);t.update(r),c(t,n)}function h(t){p(t,a(t))}function f(t){var e=function(){f(t),h(t)};t._loopId=t._scheduleUpdate.call?t._scheduleUpdate.call(v,e,1e3/t.config.fps):setTimeout(e,1e3/t.config.fps)}function l(t){var e;return e=60!==t?v.setTimeout:v.requestAnimationFrame||v.webkitRequestAnimationFrame||v.oRequestAnimationFrame||v.msRequestAnimationFrame||v.mozCancelRequestAnimationFrame&&v.mozRequestAnimationFrame||v.setTimeout}function d(t){var e;return e=60!==t?v.clearTimeout:v.cancelAnimationFrame||v.webkitCancelAnimationFrame||v.oCancelAnimationFrame||v.msCancelAnimationFrame||v.mozCancelRequestAnimationFrame||v.clearTimeout}function m(t){t._cancelUpdate.call?t._cancelUpdate.call(v,t._loopId):clearTimeout(t._loopId)}var y=Function,v=new y("return this")(),_=i.now,g={fps:60},k={STOPPED:"stopped",PAUSED:"paused",PLAYING:"playing"},T=t.Kapi||function T(t){return this.config=t||{},this.context=this.config.context||{},this._actors={},this._playState=k.STOPPED,this._events={animationComplete:[],playStateChange:[],play:[],pause:[],stop:[],beforeUpdate:[],afterUpdate:[],addActor:[],removeActor:[]},this._timesToIterate=-1,this._animationLength=0,this._loopId=null,this._loopTimestamp=null,this._pausedAtTime=null,this._lastUpdatedMillisecond=0,r.extend(this.config,t),r.defaults(this.config,g),this._scheduleUpdate=l(this.config.fps),this._cancelUpdate=d(this.config.fps),r.each(this._contextInitHook,function(t){t.call(this)},this),this};T.prototype._contextInitHook={},T.prototype.addActor=function(t){return r.contains(this._actors,t)||(t.context()||t.context(this.context),t.kapi=this,t.fps=this.framerate(),this._actors[t.id]=t,n(this),t.setup(),e(this,"addActor",r,t)),this},T.prototype.getActor=function(t){return this._actors[t]},T.prototype.getActorIds=function(){return r.pluck(this._actors,"id")},T.prototype.getAllActors=function(){return r.clone(this._actors)},T.prototype.removeActor=function(t){return delete this._actors[t.id],delete t.kapi,t.teardown(),n(this),e(this,"removeActor",r,t),this},T.prototype.play=function(t){return m(this),this._playState===k.PAUSED?this._loopTimestamp+=_()-this._pausedAtTime:this._loopTimestamp=_(),this._timesToIterate=t||-1,this._playState=k.PLAYING,f(this),e(this,"playStateChange",r),e(this,"play",r),this},T.prototype.playFrom=function(t,e){return this.play(e),this._loopTimestamp=_()-t,this},T.prototype.playFromCurrent=function(t){return this.playFrom(this._lastUpdatedMillisecond,t)},T.prototype.pause=function(){return this._playState===k.PAUSED?this:(this._playState=k.PAUSED,m(this),this._pausedAtTime=_(),e(this,"playStateChange",r),e(this,"pause",r),this)},T.prototype.stop=function(){return this._playState=k.STOPPED,m(this),r.each(this._actors,function(t){t.stop()}),e(this,"playStateChange",r),e(this,"stop",r),this},T.prototype.isPlaying=function(){return this._playState===k.PLAYING},T.prototype.animationLength=function(){return this._animationLength},T.prototype.lastPositionUpdated=function(){return this._lastUpdatedMillisecond/this._animationLength},T.prototype.actorCount=function(){return r.size(this._actors)},T.prototype.framerate=function(t){return t&&(this.config.fps=t,this._scheduleUpdate=l(this.config.fps),this._cancelUpdate=d(this.config.fps)),this.config.fps},T.prototype.update=function(t){return void 0===t&&(t=this._lastUpdatedMillisecond),e(this,"beforeUpdate",r),r.each(this._actors,function(e){e.updateState(t),"function"==typeof e.update&&e.update(e.context(),e.get())}),this._lastUpdatedMillisecond=t,e(this,"afterUpdate",r),this},T.prototype.on=function(t,e){return this._events[t]?(this._events[t].push(e),this):void 0},T.prototype.off=function(t,e){return this._events[t]?(this._events[t]=e?r.without(this._events[t],e):[],this):void 0},T.prototype.exportTimeline=function(){var t={duration:this._animationLength,actors:{}};return r.each(this._actors,function(e){t.actors[e.id]=e.exportTimeline()},this),t},T.util={},t.Kapi=T},o=function(t,e,i){"use strict";function o(t){return t.sort(function(t,e){return t-e})}function a(t,e){var n,r=t._timelinePropertyCacheIndex,i=r.length;for(n=1;i>n;n++)if(r[n]>=e)return n-1;return-1}function s(t){e.each(t._propertyTracks,function(n,r){t._propertyTracks[r]=e.sortBy(t._propertyTracks[r],function(t){return t.millisecond})})}function c(t){e.each(t._timelinePropertyCaches,function(n,r){var i=u(t,+r);e.defaults(n,i)})}function u(t,n){var r={};return e.each(t._propertyTracks,function(t,i){var o=null;if(e.find(t,function(t){return t.millisecond>n?r[i]=o:t.millisecond===n&&(r[i]=t),o=t,!!r[i]}),!r[i]){var a=e.last(t);a&&n>=a.millisecond&&(r[i]=a)}}),r}function p(t){e.each(t._propertyTracks,function(t){e.each(t,function(e,n){e.linkToNext(t[n+1])})})}function h(t,n,r){return e.find(t._propertyTracks[n],function(t){return t.millisecond===r})}function f(t){t._timelinePropertyCaches={},e.each(t._keyframeProperties,function(e){t._timelinePropertyCaches[e.millisecond]||(t._timelinePropertyCaches[e.millisecond]={}),t._timelinePropertyCaches[e.millisecond][e.name]=e},t),t._timelinePropertyCacheIndex=e.keys(t._timelinePropertyCaches),e.each(t._timelinePropertyCacheIndex,function(e,n){t._timelinePropertyCacheIndex[n]=+e},t),o(t._timelinePropertyCacheIndex),c(t),p(t)}var l="linear",d=t.Kapi,m=d.Actor=function(t){return t=t||{},i.call(this),e.extend(this,{_propertyTracks:{},_timelinePropertyCaches:{},_timelinePropertyCacheIndex:[],_keyframeProperties:{},id:e.uniqueId(),setup:t.setup||r,update:t.update||r,teardown:t.teardown||r,data:{}}),t.context&&this.context(t.context),this},y=function(){};y.prototype=i.prototype,m.prototype=new y,m.prototype.context=function(t){return t&&(this._context=t),this._context},m.prototype.keyframe=function(t,r,i){var o;return i=i||l,"string"==typeof i&&(o=i,i={},e.each(r,function(t,e){i[e]=o})),e.each(r,function(t,e){i[e]=i[e]||l}),e.each(r,function(e,n){var r=new d.KeyframeProperty(this,t,n,e,i[n]);this._keyframeProperties[r.id]=r,this._propertyTracks[n]||(this._propertyTracks[n]=[]),this._propertyTracks[n].push(r),s(this)},this),this.kapi&&n(this.kapi),f(this),this},m.prototype.getKeyframeProperty=function(t,e){return this._propertyTracks[t]&&this._propertyTracks[t][e]?this._propertyTracks[t][e]:void 0},m.prototype.modifyKeyframeProperty=function(t,e,r){return this._propertyTracks[t]&&this._propertyTracks[t][e]&&this._propertyTracks[t][e].modifyWith(r),s(this),f(this),n(this.kapi),this},m.prototype.getTrackNames=function(){return e.keys(this._propertyTracks)},m.prototype.getTrackLength=function(t){return this._propertyTracks[t]?this._propertyTracks[t].length:void 0},m.prototype.copyProperties=function(t,n){var r={},i={};return e.each(this._propertyTracks,function(t,e){var o=h(this,e,n);o&&(r[e]=o.value,i[e]=o.easing)},this),this.keyframe(t,r,i),this},m.prototype.wait=function(t){var n=this.getEnd();if(n>=t)return this;var r=this.getEnd(),i=u(this,this.getEnd()),o={},a={};return e.each(i,function(t,e){o[e]=t.value,a[e]=t.easing}),this.removeKeyframe(r),this.keyframe(r,o,a),this.keyframe(t,o,a),this},m.prototype.getStart=function(t){var n=[];return t?n.push(this._propertyTracks[t][0].millisecond):e.each(this._propertyTracks,function(t){t.length&&n.push(t[0].millisecond)}),0===n.length&&(n=[0]),Math.min.apply(Math,n)},m.prototype.getEnd=function(t){var n=0,r=this._propertyTracks;return t&&(r={},r[t]=this._propertyTracks[t]),e.each(r,function(t){if(t.length){var r=e.last(t).millisecond;r>n&&(n=r)}},this),n},m.prototype.getLength=function(t){return this.getEnd(t)-this.getStart(t)},m.prototype.hasKeyframeAt=function(t,n){var r=this._propertyTracks;if(n){if(!e.has(r,n))return!1;r=e.pick(r,n)}return void 0!==e.find(r,function(e,n){var r=h(this,n,t);return void 0!==r},this)},m.prototype.modifyKeyframe=function(t,n,r){return r=r||{},e.each(this._propertyTracks,function(e,i){var o=h(this,i,t);o&&o.modifyWith({value:n[i],easing:r[i]})},this),this},m.prototype.removeKeyframe=function(t){return e.each(this._propertyTracks,function(n){var r=-1,i=!1;if(e.find(n,function(e){return r++,i=t===e.millisecond}),i){var o=n.splice(r,1)[0];o&&delete this._keyframeProperties[o.id]}},this),this.kapi&&n(this.kapi),f(this),this},m.prototype.removeAllKeyframeProperties=function(){return e.each(this._propertyTracks,function(t){t.length=0},this),this._keyframeProperties={},this.removeKeyframe(0)},m.prototype.updateState=function(t){var n=this.getStart(),r=this.getEnd();if(t=Math.min(r,t),t>=n){var i=a(this,t),o=this._timelinePropertyCaches[this._timelinePropertyCacheIndex[i]],s={};e.each(o,function(e,n){e&&(s[n]=e.getValueAt(t))}),this.set(s)}return this},m.prototype.exportTimeline=function(){var t={start:this.getStart(),end:this.getEnd(),trackNames:this.getTrackNames(),propertyTracks:{}};return e.each(this._propertyTracks,function(n,r){var i=t.propertyTracks[r]=[];e.each(n,function(t){i.push(t.exportPropertyData())})}),t}},a=function(t,e,n){"use strict";var r="linear",i=t.Kapi,o=i.KeyframeProperty=function(t,n,i,o,a){return this.id=e.uniqueId("keyframeProperty_"),this.ownerActor=t,this.millisecond=n,this.name=i,this.value=o,this.easing=a||r,this.nextProperty=null,this};o.prototype.modifyWith=function(t){var n={};e.each(["millisecond","easing","value"],function(e){n[e]=t[e]===void 0?this[e]:t[e]},this),e.extend(this,n)},o.prototype.linkToNext=function(t){this.nextProperty=t||null},o.prototype.getValueAt=function(t){var e,r={},i={};if(this.nextProperty){r[this.name]=this.value,i[this.name]=this.nextProperty.value;var o=this.nextProperty.millisecond-this.millisecond,a=(t-this.millisecond)/o;e=n.interpolate(r,i,a,this.nextProperty.easing)[this.name]}else e=this.value;return e},o.prototype.exportPropertyData=function(){return{id:this.id,millisecond:this.millisecond,name:this.name,value:this.value,easing:this.easing}}},s=function(t,n){"use strict";function r(t,e,n){return n!==void 0&&(t[e]=n,t.style[e]=n+"px"),t[e]}function i(t){t.config.clearOnUpdate&&t.canvas.clear()}function o(t){e(t,"beforeDraw",n);var r,i=t.canvas._drawOrder.length;if(t.canvas._drawOrderSorter){var o=n.sortBy(t.canvas._canvasActors,t.canvas._drawOrderSorter);r=n.pluck(o,"id")}else r=t.canvas._drawOrder;var a,s,c;for(c=0;i>c;c++)a=t.canvas._canvasActors[r[c]],s=a.context(),a.draw(s,a.get());return e(t,"afterDraw",n),t}function a(t,e){e instanceof c.CanvasActor&&(t.canvas._drawOrder.push(e.id),t.canvas._canvasActors[e.id]=e)}function s(t,e){e instanceof c.CanvasActor&&(t.canvas._drawOrder=n.without(t.canvas._drawOrder,e.id),delete t.canvas._canvasActors[e.id])}var c=t.Kapi;c.prototype._contextInitHook.canvas=function(){this.canvas=new u(this),this.config.clearOnUpdate=!0,n.extend(this._events,{beforeDraw:[],afterDraw:[]}),n.each(["Height","Width"],function(t){var e=t.toLowerCase();this.config[e]&&(this.canvas[e](this.config[e]),delete this.config[t])},this),this.on("afterUpdate",o),this.on("addActor",a),this.on("removeActor",s),this.on("beforeDraw",i)};var u=c.CanvasRenderer=function(t){return this.kapi=t,this._drawOrder=[],this._drawOrderSorter=null,this._canvasActors={},this};u.prototype.height=function(t){return r(this.kapi.context,"height",t)},u.prototype.width=function(t){return r(this.kapi.context,"width",t)},u.prototype.clear=function(){return this.kapi.context.getContext&&this.context().clearRect(0,0,this.width(),this.height()),this.kapi},u.prototype.context=function(){return this.kapi.context.getContext("2d")},u.prototype.moveActorToLayer=function(t,e){return this._drawOrder.length>e?(this._drawOrder=n.without(this._drawOrder,t.id),this._drawOrder.splice(e,0,t.id),t):void 0},u.prototype.setOrderFunction=function(t){return this._drawOrderSorter=t,this.kapi},u.prototype.unsetOrderFunction=function(){return this._drawOrderSorter=null,this.kapi}},c=function(t){"use strict";function e(){}var n=t.Kapi;e.prototype=n.Actor.prototype;var i=n.CanvasActor=function(t){return n.Actor.call(this,t),t=t||{},this.draw=t.draw||r,this};i.prototype=new e,i.prototype.context=function(t){return t&&(this._context=t),this._context&&this._context.getContext("2d")},i.prototype.moveToLayer=function(t){return this.kapi.canvas.moveActorToLayer(this,t)}},u=function(t,e){"use strict";function n(t,e,n){t.style[e]=n}function r(t){return e.contains(u,t)}function i(t,n){var r=[];return e.each(t,function(t){n[t]&&r.push(t+"("+n[t]+")")}),r.join(" ")}function o(t,r){e.each(c,function(e){n(t,e,r)})}function a(){}var s=t.Kapi,c=["transform","webkitTransform","MozTransform","oTransform","msTransform"],u=["translateX","translateY","scale","scaleX","scaleY","rotate","skewX","skewY"];s.DOMActor=function(t){s.Actor.call(this),this._context=t;var e=this.getCSSName();return this._context.className.match(e)||(this._context.className+=" "+e),this._transformOrder=u.slice(0),delete this.update,delete this.teardown,this},a.prototype=s.Actor.prototype,s.DOMActor.prototype=new a,a.prototype.update=function(t,a){var s=e.keys(a),c=e.filter(s,r),u=e.reject(s,r),p=e.pick(a,u);if(c.length){var h=e.pick(a,c),f=i(this._transformOrder,h);o(t,f)}else a.transform&&o(t,a.transform);e.each(p,function(e,r){n(t,r,e)},this)},a.prototype.teardown=function(){var t=this._context.className.match(/\S+/g),n=e.without(t,this.getCSSName());this._context.className=n},a.prototype.getCSSName=function(){return"actor-"+this.id},a.prototype.setTransformOrder=function(t){var n=e.reject(t,r);if(n.length)throw"Unknown or unsupported transform functions: "+n.join(", ");return this._transformOrder=e.uniq(t),this}},p=function(t,e){"use strict";function n(t,n,i,o){var a=t.getTrackNames(),s=[];e.each(a,function(e){s.push(y(t,i,e))});var c=[];return e.each(a,function(t,e){c.push(r(s[e],n+"-"+t,o))}),c=c.join("\n")}function r(t,n,r){r=r||["w3"];var o=[];return e.each(r,function(e){var r=E(O,[S[e],n,t]),a=i(r,e);o.push(a)}),o.join("\n")}function i(t,e){var n=RegExp(A,"g"),r=S[e]+"transform",i=RegExp(P,"g"),o=S[e],a=t.replace(i,o).replace(n,r);return a}function o(t,n,r,i,o){r=r||["w3"];var s,c=[];e.each(r,function(e){s=a(t,n,e,i,o),c.push(s)});var u=E(I,[n,c.join("\n")]);return u}function a(t,e,n,r,i){var o=[],a=S[n];return o.push(s(t,e,a)),o.push(c(t,a)),o.push(u(t,a)),o.push(p(a)),o.push(h(a)),o.push(f(t.kapi,a,r)),i&&o.push(l(a)),o.join("\n")}function s(t,n,r){var i=E("  %sanimation-name:",[r]),o=t.getTrackNames();return e.each(o,function(t){i+=E(" %s-%s-keyframes,",[n,t])}),i=i.slice(0,i.length-1),i+=";"}function c(t,e){return E("  %sanimation-duration: %sms;",[e,t.getEnd()-t.getStart()])}function u(t,e){return E("  %sanimation-delay: %sms;",[e,t.getStart()])}function p(t){return E("  %sanimation-fill-mode: forwards;",[t])}function h(t){return E("  %sanimation-timing-function: linear;",[t])}function f(t,e,n){var r;r=n?n:-1===t._timesToIterate?"infinite":t._timesToIterate;var i="  %sanimation-iteration-count: %s;";return E(i,[e,r])}function l(t){return E("  %stransform-origin: 0 0;",[t])}function d(t){var e=!1;if(t.nextProperty){var n,r=t.nextProperty.easing.split(" "),i=0,o=r.length,a=r[0];for(i;o>i;i++){if(n=r[i],!C[n]||a!==n){e=!1;break}e=!0,a=n}}return e}function m(t,e,n){var r=[],i=t.name;"transform"===t.name&&(i=A);var o=C[t.nextProperty.easing.split(" ")[0]],a=E("cubic-bezier(%s)",[o]);return r.push(E("  %s% {%s:%s;%sanimation-timing-function: %s;}",[e,i,t.value,P,a])),r.push(E("  %s% {%s:%s;}",[n,i,t.nextProperty.value])),r.join("\n")}function y(t,n,r){var i=[],o=t.getEnd(),a=t.getStart(),s=t.getLength(),c=v(t,r,a);c&&i.push(c);var u=!1;e.each(t._propertyTracks[r],function(e){var r,o,c,p=g(e,a,s),h=e.nextProperty;if(h){r=g(h,a,s);var f=r-p;o=Math.floor(f/100*n)||1,c=f/o}else r=100,o=1,c=1;var l;d(e)?(l=m(e,p,r),u=!0):(l=k(t,e,o,c,a,p),u&&l.shift(),l.length&&(l=l.join("\n")),u=!1),l.length&&i.push(l)});var p=_(t,r,a,o);return p&&i.push(p),i.join("\n")}function v(t,e,n){var r=t._propertyTracks[e][0];if(r.millisecond!==n){var i=k(t,r,1,1,r.millisecond,0);return i.join("\n")}}function _(t,n,r,i){var o=e.last(t._propertyTracks[n]);if(o.millisecond!==i){var a=k(t,o,1,1,r,100);return a.join("\n")}}function g(t,e,n){return 100*((t.millisecond-e)/n)}function k(t,e,n,r,i,o){var a,s,c,u=[],p=t.getLength();for(a=0;n>a;a++)s=o+a*r,t.updateState(s/100*p+i),c=+s.toFixed(2)+"% ",u.push("  "+c+T(t,e.name));return u}function T(t,n){var r,i=["{"];if(n){r={};var o=t.get()[n];o!==void 0&&(r[n]=o)}else r=t.get();var a;return e.each(r,function(t,e){a=t;var n=e;"transform"===e&&(n=A),i.push(n+":"+a+";")}),i.push("}"),i.join("")}var x=t.Kapi,w=100,A="TRANSFORM",P="VENDOR",S=x.util.VENDOR_PREFIXES={microsoft:"-ms-",mozilla:"-moz-",opera:"-o-",w3:"",webkit:"-webkit-"},C={linear:".25,.25,.75,.75",easeInQuad:".55,.085,.68,.53",easeInCubic:".55,.055,.675,.19",easeInQuart:".895,.03,.685,.22",easeInQuint:".755,.05,.855,.06",easeInSine:".47,0,.745,.715",easeInExpo:".95,.05,.795,.035",easeInCirc:".6,.04,.98, .335",easeInBack:".6,-.28,.735,.045",easeOutQuad:".25,.46,.45,.94",easeOutCubic:".215,.61,.355,1",easeOutQuart:".165,.84,.44,1",easeOutQuint:".23,1,.32,1",easeOutSine:".39,.575,.565,1",easeOutExpo:".19,1,.22,1",easeOutCirc:".075,.82,.165,1",easeOutBack:".175,.885,.32,1.275",easeInOutQuad:".455,.03,.515,.955",easeInOutCubic:".645,.045,.355,1",easeInOutQuart:".77,0,.175,1",easeInOutQuint:".86,0.07,1",easeInOutSine:".445,.05,.55,.95",easeInOutExpo:"1,0,0,1",easeInOutCirc:".785,.135,.15,.86",easeInOutBack:".68,-.55,.265,1.55"},O=["@%skeyframes %s-keyframes {","%s","}"].join("\n"),I=[".%s {","%s","}"].join("\n");t.Kapi.prototype.toCSS=function(t){t=t||{};var n=[],r=this.getActorIds();return e.each(r,function(e){n.push(this.getActor(e).toCSS(t))},this),n.join("\n")},t.Kapi.Actor.prototype.toCSS=function(t){t=t||{};var e=[],r=t.name||this.getCSSName(),i=t.granularity||w,a=o(this,r,t.vendors,t.iterations,t.isCentered),s=n(this,r,i,t.vendors);return e.push(a),e.push(s),e.join("\n")};var E=x.util.printf=function(t,n){var r=t;return e.each(n,function(t){r=r.replace("%s",t)}),r}},h=function(t,e){"use strict";var n=e?{}:t,r=e&&e.underscore?e.underscore:n._,h=e&&e.Tweenable?e.Tweenable:n.Tweenable;return i(n,r,h),o(n,r,h),a(n,r,h),"function"==typeof u&&u(n,r,h),"function"==typeof p&&p(n,r,h),"function"==typeof s&&s(n,r,h),"function"==typeof c&&c(n,r,h),n.Kapi};if("function"==typeof define&&define.amd){var f="undefined"!=typeof _;define(["shifty","underscore"],function(e,n){var r=null!=n,i={Tweenable:e,underscore:r?n:_},o=h(t,i);return!f&&r&&(t._=void 0),o})}else h(t!==void 0?t:this)})(this);